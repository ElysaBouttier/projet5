<?php

namespace Elysa\Pfive\m;

class ImageManager extends BaseManager
{
    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // //////////////////////////////////////////////              CREATE              ///////////////////////////////////////////////////////
    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public function addImage($url_img, $id, $content){

        // Connect to DB
        $newManager = new BaseManager();
        $db = $newManager->dbConnect();
        // Request
        $request = $db->prepare('INSERT INTO images (url_img, post_id, content) VALUES (?, ?, ?)');
        $images = $request->execute(array($id, $url_img, $content));

        return $images;
    }


    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // //////////////////////////////////////////////              READ              ///////////////////////////////////////////////////////
    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public function getAllImageFromPost($id)
    {
        // Connect to DB
        $newManager = new BaseManager();
        $db = $newManager->dbConnect();
        // Request
        $request = $db->prepare('SELECT id, url_img, post_id, content FROM images WHERE post_id = ?');
        $request->execute(array($id));
        $result = $request->fetchAll();
        // Push in array
        $images = [];
        foreach ($result as $image) {
            $newImage = new Image($image['id'], $image['url_img'], $image['post_id'], $image['content']);
            $images[] = $newImage;
        }
        // Return a list of comment 
        return $images;
    }

    public function countImagesFromPost($id){
        $imageManager = new ImageManager;
        $images = $imageManager -> getAllImageFromPost($id);
        
        return count($images);
    }

    public function getPostIdFromId($id)
    {
        // Connect to DB
        $newManager = new BaseManager();
        $db = $newManager->dbConnect();
        // Request
        $request = $db->prepare('SELECT post_id FROM images WHERE id = ?');
        $post_id = $request->execute(array($id));
        // Return a list of comment 
        return $post_id;    
    }

    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // //////////////////////////////////////////////              UPDATE              ///////////////////////////////////////////////////////
    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // //////////////////////////////////////////////              DELETE              ///////////////////////////////////////////////////////
    // ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function deleteImage($id)
    {
        $baseManager = new BaseManager();
        $db = $baseManager->dbConnect();
        $request = $db->prepare('DELETE FROM images WHERE id = ?');
        $request->execute(array($id));
    }
}